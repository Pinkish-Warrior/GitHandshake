# Migration Plan: from npm to pnpm

This document outlines the steps to migrate this monorepo from `npm` to `pnpm`. The primary goal is to improve dependency installation speed, optimize disk space usage, and create a more robust and reliable development environment.

## Prerequisites

1.  **Install pnpm:** Before you begin, install `pnpm` globally on your machine.
    ```bash
    npm install -g pnpm
    ```

2.  **Commit Changes:** Ensure your repository is in a clean state by committing all current changes to git. This will allow you to easily revert if anything goes wrong.
    ```bash
    git add .
    git commit -m "chore: prepare for migration to pnpm"
    ```

## Migration Steps

1.  **Remove Existing `node_modules` and Lock File:**
    Delete all `node_modules` folders from the root and all workspaces, and remove the `package-lock.json` file.
    ```bash
    rm -rf node_modules apps/*/node_modules package-lock.json
    ```

2.  **Update `packageManager` Field:**
    Open the root `package.json` and change the `packageManager` field to reflect `pnpm`. You can set it to the latest version you have installed.
    ```json
    // Example
    "packageManager": "pnpm@9.1.0" 
    ```
    *You can check your pnpm version with `pnpm --version`.*

3.  **Update `package.json` Scripts:**
    In the root `package.json`, the scripts that target specific workspaces need to be updated from `npm`'s syntax to `pnpm`'s filtering syntax.

    **Change these scripts:**
    ```json
    "scripts": {
      "client": "npm run dev --workspace=client",
      "server": "npm run start:dev --workspace=server",
    }
    ```

    **To this:**
    ```json
    "scripts": {
      "client": "pnpm --filter client dev",
      "server": "pnpm --filter server start:dev",
    }
    ```
    *The `turbo` scripts (`dev`, `build`, `lint`, etc.) do not need to be changed.*

4.  **Install Dependencies:**
    Run the installation command from the root of the project. `pnpm` will read your `package.json` files, install all dependencies, and generate a `pnpm-lock.yaml` file.
    ```bash
    pnpm install
    ```

5.  **Update CI/CD (If Applicable):**
    If you have any Continuous Integration pipelines (e.g., GitHub Actions), you will need to update them. This typically involves changing steps that use `npm ci` or `npm install` to use `pnpm install`.

    **Example for GitHub Actions:**
    ```yaml
    # .github/workflows/ci.yml
    - uses: pnpm/action-setup@v3
      with:
        version: 9 # Or your desired pnpm version
    
    - name: Install dependencies
      run: pnpm install
    ```

## Testing the Migration

After the installation is complete, test the main scripts to ensure everything is working correctly.

```bash
# Test the dev server (client and server)
pnpm dev

# Test a full build
pnpm build

# Run linters
pnpm lint

# Run tests
pnpm test
```

## Finalizing

1.  **Add `pnpm-lock.yaml`:** Add the new lock file to git.
    ```bash
    git add pnpm-lock.yaml
    ```

2.  **Commit the Migration:** Commit all the changes related to the migration.
    ```bash
    git commit -m "feat: migrate from npm to pnpm"
    ```

You have now successfully migrated the project to `pnpm`.
